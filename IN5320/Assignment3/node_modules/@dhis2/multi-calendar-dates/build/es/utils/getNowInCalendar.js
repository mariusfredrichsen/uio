import { Temporal } from '@js-temporal/polyfill';
import { dhis2CalendarsMap } from '../constants/dhis2CalendarsMap';
import { getCustomCalendarIfExists, isCustomCalendar } from '../utils/helpers';

/**
 * Gets the Now DateTime in the specified calendar and timeZone
 *
 * @param calendarToUse the calendar to use
 * @param timeZone the timeZone to use
 * @returns Temporal.ZoneDateTime which can be destructured to .year, .month, .day, .hour etc... (returning the values in the specified calendar) or can .getISOFields() to return the underlying iso8601 date
 */
const getNowInCalendar = function () {
  var _Intl, _Intl$DateTimeFormat, _Intl$DateTimeFormat$, _Intl$DateTimeFormat$2, _Intl$DateTimeFormat$3, _dhis2CalendarsMap;
  let calendarToUse = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'gregory';
  let timeZone = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ((_Intl = Intl) === null || _Intl === void 0 ? void 0 : (_Intl$DateTimeFormat = _Intl.DateTimeFormat) === null || _Intl$DateTimeFormat === void 0 ? void 0 : (_Intl$DateTimeFormat$ = (_Intl$DateTimeFormat$2 = _Intl$DateTimeFormat.call(_Intl)).resolvedOptions) === null || _Intl$DateTimeFormat$ === void 0 ? void 0 : (_Intl$DateTimeFormat$3 = _Intl$DateTimeFormat$.call(_Intl$DateTimeFormat$2)) === null || _Intl$DateTimeFormat$3 === void 0 ? void 0 : _Intl$DateTimeFormat$3.timeZone) || 'UTC';
  const gregorianDate = Temporal.Now.zonedDateTime('gregory', timeZone);
  let calendar = (_dhis2CalendarsMap = dhis2CalendarsMap[calendarToUse]) !== null && _dhis2CalendarsMap !== void 0 ? _dhis2CalendarsMap : calendarToUse;
  if (isCustomCalendar(calendar)) {
    calendar = getCustomCalendarIfExists(calendar);
  }
  const result = Temporal.ZonedDateTime.from(gregorianDate).withCalendar(calendar);
  return result;
};
export default getNowInCalendar;