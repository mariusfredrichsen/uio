# Actors and Message Passing

### Exercise 1



```
enum STATE {
    SNGL, DUAL, ADD, STORE, INC;
}

monitor Calculator {
    state := None;
    mode := None;
    storage := [];
    chan from;
    Int n, m;
    ch := chan(chan from, ...);

    while (true) {
        receive(ch);

        if (state = SNGL) {
            mode = SNGL;
        } else if (state = DUAL) {
            mode = DUAL;
        } else if (state = ADD) {
            if (mode = SNGL) {
                send(from){ n + m }
            }
        } else if (state = STORE) {
            if (mode = DUAL) {
                storage.push(n);
            }
        } else if (state = INC) {
            if (mode = DUAL) {
                send(from){ sum(storage) + n }
            }
        } else {
            # error message to channel
        }
    }
}
```


solution:
```
loop1() −> receive
    {from, ADD, n, m} −> from!{n+m}, loop1();
    {from, SNGL} −> loop2(0);

loop2(n) −> receive
    {from, STORE, m} −> loop2(m);
    {from, INC, m} −> from!{n+m}, loop2(n);
    {from, DUAL} −> loop1();

Calculator {
    start () −> spawn ( fun() −> loop1()).
}

User {
    start () −> Caclulator!{self, ADD, 1, 2};
    receive {n} −> print(”result: ”+n);
}
```


